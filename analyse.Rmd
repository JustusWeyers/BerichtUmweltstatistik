---
title: "Umweltstatistik Bericht - R"
author: "Justus Weyers"
date: "`r Sys.Date()`"
output: html_document
---

### Pakete laden

```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(sf)
library(tmap)
library(glmulti)
library(car) # vif
library(corrplot)
library(GGally)
library(visreg)
```

# Einstellungen

```{r}
tmap::tmap_mode("view")
```


### Daten einlesen

```{r}
# Alles Einlesen
readin = read.table("Data/data.txt", header = TRUE)

# Verwendete Variablen auswÃ¤hlen
data = readin |> select(Punkt, Jahr, Stratum, x_UTM, y_UTM,
                        Tiefe_zum_Oxidationshorizont_cm, 
                        Maechtigkeit_Oxidationshorizont_cm, 
                        Maechtigkeit_A_Horizont_cm,
                        Maechtigkeit_AL_Schicht_cm,
                        Gelaendehoehe_m,
                        Bodenfeuchte_Prozent)

data_sf = st_as_sf(data, coords = c("x_UTM", "y_UTM"), crs = st_crs(25833))
tm_shape(data_sf) + tm_dots(col = "Tiefe_zum_Oxidationshorizont_cm")

modeldata =  data |> select(Tiefe_zum_Oxidationshorizont_cm, 
                              Maechtigkeit_Oxidationshorizont_cm, 
                              Maechtigkeit_A_Horizont_cm,
                              Maechtigkeit_AL_Schicht_cm,
                              Gelaendehoehe_m,
                              Bodenfeuchte_Prozent)

head(modeldata)
```

# Einfaches lineares Modell

```{r}
linmodel = lm(Bodenfeuchte_Prozent ~ ., data = modeldata)
res = glmulti(linmodel, level = 1, method = "h",
              confsetsize = 8)
bestmodel = res@objects[[1]]
plot(res, type = "s")
```

```{r}
cor_model = cor(modeldata, use = "pairwise.complete.obs")
p_values = cor.mtest(modeldata, conf.level = 0.95)
corrplot(cor_model, p.mat = p_values$p, insig = 'p-value', sig.level = -1)
```


```{r}
vif(linmodel)
plot(x = modeldata$Tiefe_zum_Oxidationshorizont_cm, y = modeldata$Maechtigkeit_Oxidationshorizont_cm, asp = 1)
```

```{r}
visreg(bestmodel)
```

# Predictions

```{r}
newdata = modeldata[is.na(modeldata$Bodenfeuchte_Prozent),]
x_plot = seq(0, 100)
predict(bestmodel, newdata = data.frame())
```

